version: '3.9'

services:
  frontend:
    image: node:20
    working_dir: /workspace/frontend
    volumes:
      - ./frontend:/workspace/frontend
    command: sh -c "npm install && npm run dev -- --host 0.0.0.0 --port 5173"
    ports:
      - '5173:5173'
    environment:
      - VITE_API_BASE_URL=http://localhost:7071

  functions:
    image: mcr.microsoft.com/azure-functions/dotnet-isolated:4-dotnet-isolated8.0
    working_dir: /workspace
    volumes:
      - ./backend:/workspace
    command: ["func", "start", "--cors", "*", "--verbose"]
    ports:
      - '7071:7071'
    environment:
      - AzureWebJobsStorage=${AZURE_WEBJOBS_STORAGE}
      - FUNCTIONS_WORKER_RUNTIME=${FUNCTIONS_WORKER_RUNTIME}
    depends_on:
      - azurite

  azurite:
    image: mcr.microsoft.com/azure-storage/azurite:latest
    command: azurite --blobHost 0.0.0.0 --queueHost 0.0.0.0 --tableHost 0.0.0.0
    ports:
      - '10000:10000'
      - '10001:10001'
      - '10002:10002'
    volumes:
      - azurite-data:/data

volumes:
  azurite-data:
